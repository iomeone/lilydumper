<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Tied notes - Lilyplayer's documentation</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <base href="">

        <link rel="stylesheet" href="book.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="_FontAwesome/css/font-awesome.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        

    </head>
    <body class="light">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { } 
            if (theme === null || theme === undefined) { theme = 'light'; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <ol class="chapter"><li class="affix"><a href="intro.html">Introduction</a></li><li><a href="finding_when_notes_are_played.html"><strong aria-hidden="true">1.</strong> Finding when notes are played</a></li><li><ol class="section"><li><a href="issue_with_tied_notes.html" class="active"><strong aria-hidden="true">1.1.</strong> Tied notes</a></li><li><a href="issue_with_grace_notes.html"><strong aria-hidden="true">1.2.</strong> Grace notes</a></li><li><a href="issue_with_repeats.html"><strong aria-hidden="true">1.3.</strong> Repeats</a></li><li><a href="issue_with_overlapping_notes.html"><strong aria-hidden="true">1.4.</strong> Fixing overlapping notes</a></li><li><a href="issue_with_repeated_notes.html"><strong aria-hidden="true">1.5.</strong> Separating repeated notes</a></li></ol></li><li><a href="computing_the_cursor_position.html"><strong aria-hidden="true">2.</strong> Finding where the cursor should be</a></li><li><ol class="section"><li><a href="matching_a_note_to_where_it_appears.html"><strong aria-hidden="true">2.1.</strong> Finding where notes appear on the music sheet</a></li><li><a href="finding_systems_top_and_bottom.html"><strong aria-hidden="true">2.2.</strong> Finding the top and bottom of systems</a></li><li><a href="getting_the_cursor_wrapping_all_notes_belonging_to_a_chord.html"><strong aria-hidden="true">2.3.</strong> Cursor for notes in a chord</a></li></ol></li><li><a href="finding_bar_changes.html"><strong aria-hidden="true">3.</strong> Finding bar changes events</a></li><li><a href="finding_turn_page_changes.html"><strong aria-hidden="true">4.</strong> Finding turn page events</a></li><li><a href="finding_on_which_stave_a_note_is.html"><strong aria-hidden="true">5.</strong> Left/right hand separation</a></li><li><a href="finding_the_staff_instrument_name.html"><strong aria-hidden="true">6.</strong> Getting the staff's instrument name</a></li><li><a href="file_format.html"><strong aria-hidden="true">7.</strong> File format</a></li><li><a href="possible_improvements.html"><strong aria-hidden="true">8.</strong> Possible improvements</a></li></ol>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light <span class="default">(default)</span></button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Lilyplayer's documentation</h1> 

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <a class="header" href="issue_with_tied_notes.html#issue-tied-notes" id="issue-tied-notes"><h1>Issue: tied notes</h1></a>
<p>The issue with tied notes it that they are ... tied.
Let's look at the following example to understand what the issue actually is:</p>
<p><a href="./issue_with_tied_notes_assets/simplest_with_tied_notes.ly" title="lilypond source for this simple example with tied notes"><img src="./issue_with_tied_notes_assets/simplest_with_tied_notes.svg" alt="simple music sheet with tied notes" /></a></p>
<p>This music sheet means that the <code>la</code> key must be pressed only once, and for a total of 1.2s (two quarter time)
However, when simply using the default event listener, the output we get is as follow:</p>
<pre><code>0.00000000	tempo	400.00000000
0.00000000	note	69	4	0.25000000	point-and-click 4 36
0.00000000	tie
0.25000000	note	69	4	0.25000000	point-and-click 11 36
</code></pre>
<p>The event listener generates lines per ... event, and on the music sheet there are two notes, hence two lines.
Instead of saying there should only be one key pressed, it says the key should be pressed twice, which is wrong.</p>
<p>My first approach to tackle this issue was to use the midi file. <a href="http://lilypond.org">Lilypond</a> can generate
a midi file alongside the music sheet. As a rough estimate approximation, a midi file is akin to an mp3 file
but for instrument music only.  Since lilypond generates midi file that correctly describes how the music is played, it
would be possible to know if a key is played longer than what is described in the events file, and thus if it
is tied to the next key with the same pitch.  This lead me to develop
<a href="https://github.com/s-d-m/pianoterm">pianoterm</a>. However some issues with this approach quickly appeared. When
playing triolet for example, there is a slight difference in the timings outputed in the events file and
the one in the midi files due to some rounding in the midi file. This could be easily fixed by correlating the
timings, however this approach looked a bit too britle hence I looked for something else.</p>
<p>On the generated events above, we can see there is a <code>tie</code> event. We could use this as it means the previous
note has a tie attached, but sadly this is not precise enough. For example, the following two equivalents
music sheets provides the following two different events:</p>
<table><thead><tr><th> music sheet </th><th> lilypond source </th><th> generated events </th></tr></thead><tbody>
<tr><td> <a href="./issue_with_tied_notes_assets/tied_notes_chord_1.ly" title="lilypond source for this simple example with tied notes"><img src="./issue_with_tied_notes_assets/tied_notes_chord_1.svg" alt="tied_notes_chord_1" /></a> </td><td> &lt;la' sol'&gt;4~ &lt;la' sol'&gt; </td><td>  <object type="text" data="./issue_with_tied_notes_assets/tied_notes_chord_1-unnamed-staff.notes"></object> </td></tr>
<tr><td> <a href="./issue_with_tied_notes_assets/tied_notes_chord_2.ly" title="lilypond source for this simple example with tied notes"><img src="./issue_with_tied_notes_assets/tied_notes_chord_2.svg" alt="tied_notes_chord_2" /></a> </td><td> &lt;sol' la'&gt;4~ &lt;sol' la'&gt; </td><td>  <object type="text" data="./issue_with_tied_notes_assets/tied_notes_chord_2-unnamed-staff.notes"></object> </td></tr>
</tbody></table>
<p>On the first first music sheet, looking at the generated events only, it looks like the tie applies to the <code>sol</code> key,
whereas on the second one it looks like it applies to the <code>la</code> key. Truth is, both the <code>sol</code> and <code>la</code> key have a tie
attached.</p>
<p>For an even more contrived example, the two following distinct music sheets give the same tie events (as
seen per the event-listener)</p>
<table><thead><tr><th> music sheet </th><th> Source </th><th> generated events </th></tr></thead><tbody>
<tr><td> <a href="./issue_with_tied_notes_assets/tied_notes_with_same_tie_events1.ly" title="lilypond source for this simple example with tied notes"><img src="./issue_with_tied_notes_assets/tied_notes_with_same_tie_events1.svg" alt="tied notes_with_same_tie_events1" /></a> </td><td> &lt;sol' la'~ mi''&gt;4~  &lt;sol' la' mi''&gt;4 </td><td> <object type="text" data="./issue_with_tied_notes_assets/tied_notes_with_same_tie_events1-unnamed-staff.notes"></object> </td></tr>
<tr><td> <a href="./issue_with_tied_notes_assets/tied_notes_with_same_tie_events2.ly" title="lilypond source for this simple example with tied notes"><img src="./issue_with_tied_notes_assets/tied_notes_with_same_tie_events2.svg" alt="tied notes_with_same_tie_events2" /></a> </td><td> &lt;sol' la' mi''&gt;4~ la' </td><td> <object type="text" data="./issue_with_tied_notes_assets/tied_notes_with_same_tie_events2-unnamed-staff.notes"></object> </td></tr>
</tbody></table>
<p>One solution to overcome this issue would be to get on each line corresponding to a note, something saying if
yes or no there is a tie attached to that note.</p>
<p>Since Lilypond provides the option to let the user include file for global settings, I used it to extract more data
from the event-listener than the default one.</p>
<p>That is, I created a file named <code>event-listener.scm</code> with <a href="./issue_with_tied_notes_assets/event-listener.scm.for_tied_notes_only">this content</a> and then called lilypond using <code>lilypond -dinclude-settings=event-listener.scm &lt;music-sheet.ly&gt;</code>.</p>
<p>The following table shows the new event-listener's output:</p>
<table><thead><tr><th> music sheet </th><th> source </th><th>  generated events </th></tr></thead><tbody>
<tr><td> <a href="./issue_with_tied_notes_assets/tied_notes_chord_1.ly" title="lilypond source for this simple example with tied notes"><img src="./issue_with_tied_notes_assets/tied_notes_chord_1.svg" alt="tied_notes_chord_1" /></a> </td><td> &lt;la' sol'&gt;4~ &lt;la' sol'&gt; </td><td>  <object type="text" data="./issue_with_tied_notes_assets/tied_notes_chord_1_tie_event_on_note"></object> </td></tr>
<tr><td> <a href="./issue_with_tied_notes_assets/tied_notes_chord_2.ly" title="lilypond source for this simple example with tied notes"><img src="./issue_with_tied_notes_assets/tied_notes_chord_2.svg" alt="tied_notes_chord_2" /></a> </td><td> &lt;sol' la'&gt;4~ &lt;sol' la'&gt; </td><td>  <object type="text" data="./issue_with_tied_notes_assets/tied_notes_chord_2_tie_event_on_note"></object> </td></tr>
</tbody></table>
<p>Sadly, on these generated events, it says no notes have a tie attached. On a positive side we can say that at least
we got some consistency here. Two different inputs which are logically equivalent now generates the same output,</p>
<p>One way to workaround the issue, is to rewrite the music sheet to explicitly say that each note on the chord
has a tie attached instead of saying the whole chord has a tie attached. Below show the difference in writing
the input, and the generated output.</p>
<table><thead><tr><th> music sheet </th><th> source </th><th>  generated events </th></tr></thead><tbody>
<tr><td> <a href="./issue_with_tied_notes_assets/separately_tied_notes_chord.ly" title="lilypond source for this simple example with tied notes"><img src="./issue_with_tied_notes_assets/separately_tied_notes_chord.svg" alt="separately_tied_notes_chord" /></a> </td><td> &lt;la'~ sol'~&gt;4 &lt;la' sol'&gt; </td><td>  <object type="text" data="./issue_with_tied_notes_assets/separately_tied_notes_chord_tie_event_on_note"></object> </td></tr>
<tr><td> <a href="./issue_with_tied_notes_assets/separately_tied_notes_chord2.ly" title="lilypond source for this simple example with tied notes"><img src="./issue_with_tied_notes_assets/separately_tied_notes_chord2.svg" alt="separately_tied_notes_chord2" /></a> </td><td> &lt;sol' la'~ mi''&gt;4 la' </td><td>  <object type="text" data="./issue_with_tied_notes_assets/separately_tied_notes_chord2_tie_event_on_note"></object> </td></tr>
<tr><td> <a href="./issue_with_tied_notes_assets/separately_tied_notes_chord3.ly" title="lilypond source for this simple example with tied notes"><img src="./issue_with_tied_notes_assets/separately_tied_notes_chord3.svg" alt="separately_tied_notes_chord3" /></a> </td><td> &lt;sol'~ la'~ mi''~&gt;4   &lt;sol' la' mi''&gt;4 </td><td>  <object type="text" data="./issue_with_tied_notes_assets/separately_tied_notes_chord3_tie_event_on_note"></object> </td></tr>
</tbody></table>
<p>Now we properly get for each note if there is a tie attached to it. This solution is not satisfactory
as it requires modifying by hand the input music sheet, but sadly I could not find anything better yet.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="finding_when_notes_are_played.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="issue_with_grace_notes.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="finding_when_notes_are_played.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="issue_with_grace_notes.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        

        
        <script src="searchindex.js" type="text/javascript" charset="utf-8"></script>
        
        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

    </body>
</html>
